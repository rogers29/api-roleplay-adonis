"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("./../../database/factories/index");
const japa_1 = __importDefault(require("japa"));
const supertest_1 = __importDefault(require("supertest"));
const Database_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Lucid/Database"));
const Hash_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Core/Hash"));
const BASE_URL = `http://${process.env.HOST}:${process.env.PORT}`;
let token = '';
let user = {};
japa_1.default.group('User', (group) => {
    (0, japa_1.default)('it should create an user', async (assert) => {
        const userPayload = {
            email: 'test@test.com',
            username: 'test',
            password: 'test',
            avatar: 'https://images.com/image/1',
        };
        const { body } = await (0, supertest_1.default)(BASE_URL).post('/users').send(userPayload).expect(201);
        assert.exists(body.user, 'User undefined');
        assert.exists(body.user.id, 'Id undefined');
        assert.equal(body.user.email, userPayload.email);
        assert.equal(body.user.username, userPayload.username);
        assert.notExists(body.user.password, 'Password defined');
    });
    (0, japa_1.default)('it should return 409 when email is already in use', async (assert) => {
        const { email } = await index_1.UserFactory.create();
        const { body } = await (0, supertest_1.default)(BASE_URL)
            .post('/users')
            .send({
            email,
            username: 'test',
            password: 'test',
        }).expect(409);
        assert.include(body.message, 'email');
        assert.equal(body.code, 'BAD_REQUEST');
        assert.equal(body.status, 409);
    });
    (0, japa_1.default)('it should return 409 when username is already in use', async (assert) => {
        const { username } = await index_1.UserFactory.create();
        const { body } = await (0, supertest_1.default)(BASE_URL)
            .post('/users')
            .send({
            email: 'test@test.com',
            username,
            password: 'test',
        }).expect(409);
        assert.include(body.message, 'username');
        assert.equal(body.code, 'BAD_REQUEST');
        assert.equal(body.status, 409);
    });
    (0, japa_1.default)('it should return 422 when required data is not provided', async (assert) => {
        const { body } = await (0, supertest_1.default)(BASE_URL).post('/users').send({}).expect(422);
        assert.equal(body.code, 'BAD_REQUEST');
        assert.equal(body.status, 422);
    });
    (0, japa_1.default)('it should return 422 when providing an invalid email', async (assert) => {
        const { body } = await (0, supertest_1.default)(BASE_URL).post('/users').send({
            email: 'test@',
            username: 'test',
            password: 'test',
        }).expect(422);
        assert.equal(body.code, 'BAD_REQUEST');
        assert.equal(body.status, 422);
    });
    (0, japa_1.default)('it should return 422 when providing an invalid password', async (assert) => {
        const { body } = await (0, supertest_1.default)(BASE_URL).post('/users').send({
            email: 'test@test.com',
            username: 'test',
            password: 'tes',
        }).expect(422);
        assert.equal(body.code, 'BAD_REQUEST');
        assert.equal(body.status, 422);
    });
    (0, japa_1.default)('it should update an user', async (assert) => {
        const email = 'test@test.com';
        const avatar = 'https://github.com/image.png';
        const { body } = await (0, supertest_1.default)(BASE_URL)
            .put(`/users/${user.id}`)
            .set('Authorization', `Bearer ${token}`)
            .send({
            email,
            avatar,
            password: user.password,
        }).expect(200);
        assert.exists(body.user, 'User underfined');
        assert.equal(body.user.email, email);
        assert.equal(body.user.avatar, avatar);
        assert.equal(body.user.id, user.id);
    });
    (0, japa_1.default)('it should update the password of the user', async (assert) => {
        const password = 'test';
        const { body } = await (0, supertest_1.default)(BASE_URL)
            .put(`/users/${user.id}`)
            .set('Authorization', `Bearer ${token}`)
            .send({
            email: user.email,
            avatar: user.avatar,
            password,
        }).expect(200);
        assert.exists(body.user, 'User underfined');
        assert.equal(body.user.id, user.id);
        await user.refresh();
        assert.isTrue(await Hash_1.default.verify(user.password, password));
    });
    (0, japa_1.default)('it should return 422 wnhe required data is not provided', async (assert) => {
        const { id } = await index_1.UserFactory.create();
        const { body } = await (0, supertest_1.default)(BASE_URL)
            .put(`/users/${id}`)
            .set('Authorization', `Bearer ${token}`)
            .send({})
            .expect(422);
        assert.equal(body.code, 'BAD_REQUEST');
        assert.equal(body.status, 422);
    });
    (0, japa_1.default)('it should return 422 when provinding an invalid email', async (assert) => {
        const { id, password, avatar } = await index_1.UserFactory.create();
        const { body } = await (0, supertest_1.default)(BASE_URL)
            .put(`/users/${id}`)
            .set('Authorization', `Bearer ${token}`)
            .send({
            password,
            avatar,
            email: 'test@',
        }).expect(422);
        assert.equal(body.code, 'BAD_REQUEST');
        assert.equal(body.status, 422);
    });
    (0, japa_1.default)('it should return 422 when provinding an invalid password', async (assert) => {
        const { id, email, avatar } = await index_1.UserFactory.create();
        const { body } = await (0, supertest_1.default)(BASE_URL)
            .put(`/users/${id}`)
            .set('Authorization', `Bearer ${token}`)
            .send({
            password: 'tes',
            avatar,
            email,
        }).expect(422);
        assert.equal(body.code, 'BAD_REQUEST');
        assert.equal(body.status, 422);
    });
    (0, japa_1.default)('it should return 422 when provinding an invalid avatar', async (assert) => {
        const { id, password, email } = await index_1.UserFactory.create();
        const { body } = await (0, supertest_1.default)(BASE_URL)
            .put(`/users/${id}`)
            .set('Authorization', `Bearer ${token}`)
            .send({
            password,
            avatar: 'teste',
            email,
        }).expect(422);
        assert.equal(body.code, 'BAD_REQUEST');
        assert.equal(body.status, 422);
    });
    group.before(async () => {
        const plainPassword = 'test';
        const newUser = await index_1.UserFactory.merge({ password: plainPassword }).create();
        const { body } = await (0, supertest_1.default)(BASE_URL)
            .post('/sessions')
            .send({ email: newUser.email, password: plainPassword })
            .expect(201);
        token = body.token.token;
        user = newUser;
    });
    group.after(async () => {
        await (0, supertest_1.default)(BASE_URL)
            .delete('/sessions')
            .set('Authorization', `Bearer ${token}`);
    });
    group.beforeEach(async () => {
        await Database_1.default.beginGlobalTransaction();
    });
    group.afterEach(async () => {
        await Database_1.default.rollbackGlobalTransaction();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlcnMuc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInVzZXJzLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSw0REFBOEQ7QUFDOUQsZ0RBQXVCO0FBQ3ZCLDBEQUFpQztBQUNqQywyRkFBaUQ7QUFDakQsa0ZBQXdDO0FBR3hDLE1BQU0sUUFBUSxHQUFHLFVBQVUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtBQUVqRSxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUE7QUFDZCxJQUFJLElBQUksR0FBRyxFQUFVLENBQUE7QUFZckIsY0FBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRTtJQUMzQixJQUFBLGNBQUksRUFBQywwQkFBMEIsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUU7UUFDaEQsTUFBTSxXQUFXLEdBQUc7WUFDbEIsS0FBSyxFQUFFLGVBQWU7WUFDdEIsUUFBUSxFQUFFLE1BQU07WUFDaEIsUUFBUSxFQUFFLE1BQU07WUFDaEIsTUFBTSxFQUFFLDRCQUE0QjtTQUNyQyxDQUFBO1FBQ0QsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLE1BQU0sSUFBQSxtQkFBUyxFQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ3ZGLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxDQUFBO1FBQzFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsY0FBYyxDQUFDLENBQUE7UUFDM0MsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDaEQsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDdEQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxrQkFBa0IsQ0FBQyxDQUFBO0lBQzFELENBQUMsQ0FBQyxDQUFBO0lBRUYsSUFBQSxjQUFJLEVBQUMsbURBQW1ELEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQ3pFLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxNQUFNLG1CQUFXLENBQUMsTUFBTSxFQUFFLENBQUE7UUFDNUMsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLE1BQU0sSUFBQSxtQkFBUyxFQUFDLFFBQVEsQ0FBQzthQUN2QyxJQUFJLENBQUMsUUFBUSxDQUFDO2FBQ2QsSUFBSSxDQUFDO1lBQ0osS0FBSztZQUNMLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLFFBQVEsRUFBRSxNQUFNO1NBQ2pCLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFaEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFBO1FBQ3JDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxhQUFhLENBQUMsQ0FBQTtRQUN0QyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDaEMsQ0FBQyxDQUFDLENBQUE7SUFFRixJQUFBLGNBQUksRUFBQyxzREFBc0QsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUU7UUFDNUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLE1BQU0sbUJBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtRQUMvQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxJQUFBLG1CQUFTLEVBQUMsUUFBUSxDQUFDO2FBQ3ZDLElBQUksQ0FBQyxRQUFRLENBQUM7YUFDZCxJQUFJLENBQUM7WUFDSixLQUFLLEVBQUUsZUFBZTtZQUN0QixRQUFRO1lBQ1IsUUFBUSxFQUFFLE1BQU07U0FDakIsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUVoQixNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUE7UUFDeEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxDQUFBO1FBQ3RDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUNoQyxDQUFDLENBQUMsQ0FBQTtJQUVGLElBQUEsY0FBSSxFQUFDLHlEQUF5RCxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsRUFBRTtRQUMvRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxJQUFBLG1CQUFTLEVBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDOUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxDQUFBO1FBQ3RDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUNoQyxDQUFDLENBQUMsQ0FBQTtJQUVGLElBQUEsY0FBSSxFQUFDLHNEQUFzRCxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsRUFBRTtRQUM1RSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxJQUFBLG1CQUFTLEVBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUM3RCxLQUFLLEVBQUUsT0FBTztZQUNkLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLFFBQVEsRUFBRSxNQUFNO1NBQ2pCLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDZCxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFDdEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ2hDLENBQUMsQ0FBQyxDQUFBO0lBRUYsSUFBQSxjQUFJLEVBQUMseURBQXlELEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQy9FLE1BQU0sRUFBQyxJQUFJLEVBQUMsR0FBRyxNQUFNLElBQUEsbUJBQVMsRUFBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDO1lBQzNELEtBQUssRUFBRSxlQUFlO1lBQ3RCLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLFFBQVEsRUFBRSxLQUFLO1NBQ2hCLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDZCxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFDdEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ2hDLENBQUMsQ0FBQyxDQUFBO0lBRUYsSUFBQSxjQUFJLEVBQUMsMEJBQTBCLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQ2hELE1BQU0sS0FBSyxHQUFHLGVBQWUsQ0FBQTtRQUM3QixNQUFNLE1BQU0sR0FBRyw4QkFBOEIsQ0FBQTtRQUU3QyxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxJQUFBLG1CQUFTLEVBQUMsUUFBUSxDQUFDO2FBQ3ZDLEdBQUcsQ0FBQyxVQUFVLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQzthQUN4QixHQUFHLENBQUMsZUFBZSxFQUFFLFVBQVUsS0FBSyxFQUFFLENBQUM7YUFDdkMsSUFBSSxDQUFDO1lBQ0osS0FBSztZQUNMLE1BQU07WUFDTixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7U0FDeEIsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUVoQixNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsaUJBQWlCLENBQUMsQ0FBQTtRQUMzQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ3BDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUE7UUFDdEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUE7SUFDckMsQ0FBQyxDQUFDLENBQUE7SUFFRixJQUFBLGNBQUksRUFBQywyQ0FBMkMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUU7UUFDakUsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFBO1FBRXZCLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLElBQUEsbUJBQVMsRUFBQyxRQUFRLENBQUM7YUFDdkMsR0FBRyxDQUFDLFVBQVUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO2FBQ3hCLEdBQUcsQ0FBQyxlQUFlLEVBQUUsVUFBVSxLQUFLLEVBQUUsQ0FBQzthQUN2QyxJQUFJLENBQUM7WUFDSixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7WUFDakIsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNO1lBQ25CLFFBQVE7U0FDVCxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBRWhCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxpQkFBaUIsQ0FBQyxDQUFBO1FBQzNDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBRW5DLE1BQU0sSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFBO1FBQ3BCLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxjQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQTtJQUMzRCxDQUFDLENBQUMsQ0FBQTtJQUVGLElBQUEsY0FBSSxFQUFDLHlEQUF5RCxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsRUFBRTtRQUMvRSxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsTUFBTSxtQkFBVyxDQUFDLE1BQU0sRUFBRSxDQUFBO1FBRXpDLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLElBQUEsbUJBQVMsRUFBQyxRQUFRLENBQUM7YUFDdkMsR0FBRyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUM7YUFDbkIsR0FBRyxDQUFDLGVBQWUsRUFBRSxVQUFVLEtBQUssRUFBRSxDQUFDO2FBQ3ZDLElBQUksQ0FBQyxFQUFFLENBQUM7YUFDUixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFZCxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFDdEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ2hDLENBQUMsQ0FBQyxDQUFBO0lBRUYsSUFBQSxjQUFJLEVBQUMsdURBQXVELEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQzdFLE1BQU0sRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxHQUFHLE1BQU0sbUJBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtRQUUzRCxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxJQUFBLG1CQUFTLEVBQUMsUUFBUSxDQUFDO2FBQ3ZDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDO2FBQ25CLEdBQUcsQ0FBQyxlQUFlLEVBQUUsVUFBVSxLQUFLLEVBQUUsQ0FBQzthQUN2QyxJQUFJLENBQUM7WUFDSixRQUFRO1lBQ1IsTUFBTTtZQUNOLEtBQUssRUFBRSxPQUFPO1NBQ2YsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUVoQixNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFDdEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ2hDLENBQUMsQ0FBQyxDQUFBO0lBRUYsSUFBQSxjQUFJLEVBQUMsMERBQTBELEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQ2hGLE1BQU0sRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxHQUFHLE1BQU0sbUJBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtRQUV4RCxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxJQUFBLG1CQUFTLEVBQUMsUUFBUSxDQUFDO2FBQ3ZDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDO2FBQ25CLEdBQUcsQ0FBQyxlQUFlLEVBQUUsVUFBVSxLQUFLLEVBQUUsQ0FBQzthQUN2QyxJQUFJLENBQUM7WUFDSixRQUFRLEVBQUUsS0FBSztZQUNmLE1BQU07WUFDTixLQUFLO1NBQ04sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUVoQixNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFDdEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ2hDLENBQUMsQ0FBQyxDQUFBO0lBRUYsSUFBQSxjQUFJLEVBQUMsd0RBQXdELEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQzlFLE1BQU0sRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxHQUFHLE1BQU0sbUJBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtRQUUxRCxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxJQUFBLG1CQUFTLEVBQUMsUUFBUSxDQUFDO2FBQ3ZDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDO2FBQ25CLEdBQUcsQ0FBQyxlQUFlLEVBQUUsVUFBVSxLQUFLLEVBQUUsQ0FBQzthQUN2QyxJQUFJLENBQUM7WUFDSixRQUFRO1lBQ1IsTUFBTSxFQUFFLE9BQU87WUFDZixLQUFLO1NBQ04sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUVoQixNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFDdEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ2hDLENBQUMsQ0FBQyxDQUFBO0lBRUYsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLElBQUksRUFBRTtRQUN0QixNQUFNLGFBQWEsR0FBRyxNQUFNLENBQUE7UUFDNUIsTUFBTSxPQUFPLEdBQUcsTUFBTSxtQkFBVyxDQUFDLEtBQUssQ0FBQyxFQUFFLFFBQVEsRUFBRSxhQUFhLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFBO1FBQzdFLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLElBQUEsbUJBQVMsRUFBQyxRQUFRLENBQUM7YUFDdkMsSUFBSSxDQUFDLFdBQVcsQ0FBQzthQUNqQixJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsYUFBYSxFQUFFLENBQUM7YUFDdkQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBRWQsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFBO1FBQ3hCLElBQUksR0FBRyxPQUFPLENBQUE7SUFDaEIsQ0FBQyxDQUFDLENBQUE7SUFFRixLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3JCLE1BQU0sSUFBQSxtQkFBUyxFQUFDLFFBQVEsQ0FBQzthQUN0QixNQUFNLENBQUMsV0FBVyxDQUFDO2FBQ25CLEdBQUcsQ0FBQyxlQUFlLEVBQUUsVUFBVSxLQUFLLEVBQUUsQ0FBQyxDQUFBO0lBQzVDLENBQUMsQ0FBQyxDQUFBO0lBRUYsS0FBSyxDQUFDLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUMxQixNQUFNLGtCQUFRLENBQUMsc0JBQXNCLEVBQUUsQ0FBQTtJQUN6QyxDQUFDLENBQUMsQ0FBQTtJQUNGLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDekIsTUFBTSxrQkFBUSxDQUFDLHlCQUF5QixFQUFFLENBQUE7SUFDNUMsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFVzZXJGYWN0b3J5IH0gZnJvbSAnLi8uLi8uLi9kYXRhYmFzZS9mYWN0b3JpZXMvaW5kZXgnXG5pbXBvcnQgdGVzdCBmcm9tICdqYXBhJ1xuaW1wb3J0IHN1cGVydGVzdCBmcm9tICdzdXBlcnRlc3QnXG5pbXBvcnQgRGF0YWJhc2UgZnJvbSAnQGlvYzpBZG9uaXMvTHVjaWQvRGF0YWJhc2UnXG5pbXBvcnQgSGFzaCBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0hhc2gnXG5pbXBvcnQgVXNlciBmcm9tICdBcHAvTW9kZWxzL1VzZXInXG5cbmNvbnN0IEJBU0VfVVJMID0gYGh0dHA6Ly8ke3Byb2Nlc3MuZW52LkhPU1R9OiR7cHJvY2Vzcy5lbnYuUE9SVH1gXG5cbmxldCB0b2tlbiA9ICcnXG5sZXQgdXNlciA9IHt9IGFzIFVzZXJcblxuLypcbiAge1xuICAgIFwidXNlcnNcIjoge1xuICAgICAgXCJlbWFpbFwiOiBzdHJpbmcsXG4gICAgICBcInVzZXJuYW1lXCI6IHN0cmluZyxcbiAgICAgIFwicGFzc3dvcmRcIjogc3RyaW5nLFxuICAgICAgXCJhdmF0YXJcIjogc3RyaW5nXG4gICAgfVxuICB9XG4qL1xudGVzdC5ncm91cCgnVXNlcicsIChncm91cCkgPT4ge1xuICB0ZXN0KCdpdCBzaG91bGQgY3JlYXRlIGFuIHVzZXInLCBhc3luYyAoYXNzZXJ0KSA9PiB7XG4gICAgY29uc3QgdXNlclBheWxvYWQgPSB7XG4gICAgICBlbWFpbDogJ3Rlc3RAdGVzdC5jb20nLFxuICAgICAgdXNlcm5hbWU6ICd0ZXN0JyxcbiAgICAgIHBhc3N3b3JkOiAndGVzdCcsXG4gICAgICBhdmF0YXI6ICdodHRwczovL2ltYWdlcy5jb20vaW1hZ2UvMScsXG4gICAgfVxuICAgIGNvbnN0IHsgYm9keSB9ID0gYXdhaXQgc3VwZXJ0ZXN0KEJBU0VfVVJMKS5wb3N0KCcvdXNlcnMnKS5zZW5kKHVzZXJQYXlsb2FkKS5leHBlY3QoMjAxKVxuICAgIGFzc2VydC5leGlzdHMoYm9keS51c2VyLCAnVXNlciB1bmRlZmluZWQnKVxuICAgIGFzc2VydC5leGlzdHMoYm9keS51c2VyLmlkLCAnSWQgdW5kZWZpbmVkJylcbiAgICBhc3NlcnQuZXF1YWwoYm9keS51c2VyLmVtYWlsLCB1c2VyUGF5bG9hZC5lbWFpbClcbiAgICBhc3NlcnQuZXF1YWwoYm9keS51c2VyLnVzZXJuYW1lLCB1c2VyUGF5bG9hZC51c2VybmFtZSlcbiAgICBhc3NlcnQubm90RXhpc3RzKGJvZHkudXNlci5wYXNzd29yZCwgJ1Bhc3N3b3JkIGRlZmluZWQnKVxuICB9KVxuXG4gIHRlc3QoJ2l0IHNob3VsZCByZXR1cm4gNDA5IHdoZW4gZW1haWwgaXMgYWxyZWFkeSBpbiB1c2UnLCBhc3luYyAoYXNzZXJ0KSA9PiB7XG4gICAgY29uc3QgeyBlbWFpbCB9ID0gYXdhaXQgVXNlckZhY3RvcnkuY3JlYXRlKClcbiAgICBjb25zdCB7IGJvZHkgfSA9IGF3YWl0IHN1cGVydGVzdChCQVNFX1VSTClcbiAgICAgIC5wb3N0KCcvdXNlcnMnKVxuICAgICAgLnNlbmQoe1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgdXNlcm5hbWU6ICd0ZXN0JyxcbiAgICAgICAgcGFzc3dvcmQ6ICd0ZXN0JyxcbiAgICAgIH0pLmV4cGVjdCg0MDkpXG5cbiAgICBhc3NlcnQuaW5jbHVkZShib2R5Lm1lc3NhZ2UsICdlbWFpbCcpXG4gICAgYXNzZXJ0LmVxdWFsKGJvZHkuY29kZSwgJ0JBRF9SRVFVRVNUJylcbiAgICBhc3NlcnQuZXF1YWwoYm9keS5zdGF0dXMsIDQwOSlcbiAgfSlcblxuICB0ZXN0KCdpdCBzaG91bGQgcmV0dXJuIDQwOSB3aGVuIHVzZXJuYW1lIGlzIGFscmVhZHkgaW4gdXNlJywgYXN5bmMgKGFzc2VydCkgPT4ge1xuICAgIGNvbnN0IHsgdXNlcm5hbWUgfSA9IGF3YWl0IFVzZXJGYWN0b3J5LmNyZWF0ZSgpXG4gICAgY29uc3QgeyBib2R5IH0gPSBhd2FpdCBzdXBlcnRlc3QoQkFTRV9VUkwpXG4gICAgICAucG9zdCgnL3VzZXJzJylcbiAgICAgIC5zZW5kKHtcbiAgICAgICAgZW1haWw6ICd0ZXN0QHRlc3QuY29tJyxcbiAgICAgICAgdXNlcm5hbWUsXG4gICAgICAgIHBhc3N3b3JkOiAndGVzdCcsXG4gICAgICB9KS5leHBlY3QoNDA5KVxuXG4gICAgYXNzZXJ0LmluY2x1ZGUoYm9keS5tZXNzYWdlLCAndXNlcm5hbWUnKVxuICAgIGFzc2VydC5lcXVhbChib2R5LmNvZGUsICdCQURfUkVRVUVTVCcpXG4gICAgYXNzZXJ0LmVxdWFsKGJvZHkuc3RhdHVzLCA0MDkpXG4gIH0pXG5cbiAgdGVzdCgnaXQgc2hvdWxkIHJldHVybiA0MjIgd2hlbiByZXF1aXJlZCBkYXRhIGlzIG5vdCBwcm92aWRlZCcsIGFzeW5jIChhc3NlcnQpID0+IHtcbiAgICBjb25zdCB7IGJvZHkgfSA9IGF3YWl0IHN1cGVydGVzdChCQVNFX1VSTCkucG9zdCgnL3VzZXJzJykuc2VuZCh7fSkuZXhwZWN0KDQyMilcbiAgICBhc3NlcnQuZXF1YWwoYm9keS5jb2RlLCAnQkFEX1JFUVVFU1QnKVxuICAgIGFzc2VydC5lcXVhbChib2R5LnN0YXR1cywgNDIyKVxuICB9KVxuXG4gIHRlc3QoJ2l0IHNob3VsZCByZXR1cm4gNDIyIHdoZW4gcHJvdmlkaW5nIGFuIGludmFsaWQgZW1haWwnLCBhc3luYyAoYXNzZXJ0KSA9PiB7XG4gICAgY29uc3QgeyBib2R5IH0gPSBhd2FpdCBzdXBlcnRlc3QoQkFTRV9VUkwpLnBvc3QoJy91c2VycycpLnNlbmQoe1xuICAgICAgZW1haWw6ICd0ZXN0QCcsXG4gICAgICB1c2VybmFtZTogJ3Rlc3QnLFxuICAgICAgcGFzc3dvcmQ6ICd0ZXN0JyxcbiAgICB9KS5leHBlY3QoNDIyKVxuICAgIGFzc2VydC5lcXVhbChib2R5LmNvZGUsICdCQURfUkVRVUVTVCcpXG4gICAgYXNzZXJ0LmVxdWFsKGJvZHkuc3RhdHVzLCA0MjIpXG4gIH0pXG5cbiAgdGVzdCgnaXQgc2hvdWxkIHJldHVybiA0MjIgd2hlbiBwcm92aWRpbmcgYW4gaW52YWxpZCBwYXNzd29yZCcsIGFzeW5jIChhc3NlcnQpID0+IHtcbiAgICBjb25zdCB7Ym9keX0gPSBhd2FpdCBzdXBlcnRlc3QoQkFTRV9VUkwpLnBvc3QoJy91c2VycycpLnNlbmQoe1xuICAgICAgZW1haWw6ICd0ZXN0QHRlc3QuY29tJyxcbiAgICAgIHVzZXJuYW1lOiAndGVzdCcsXG4gICAgICBwYXNzd29yZDogJ3RlcycsXG4gICAgfSkuZXhwZWN0KDQyMilcbiAgICBhc3NlcnQuZXF1YWwoYm9keS5jb2RlLCAnQkFEX1JFUVVFU1QnKVxuICAgIGFzc2VydC5lcXVhbChib2R5LnN0YXR1cywgNDIyKVxuICB9KVxuXG4gIHRlc3QoJ2l0IHNob3VsZCB1cGRhdGUgYW4gdXNlcicsIGFzeW5jIChhc3NlcnQpID0+IHtcbiAgICBjb25zdCBlbWFpbCA9ICd0ZXN0QHRlc3QuY29tJ1xuICAgIGNvbnN0IGF2YXRhciA9ICdodHRwczovL2dpdGh1Yi5jb20vaW1hZ2UucG5nJ1xuXG4gICAgY29uc3QgeyBib2R5IH0gPSBhd2FpdCBzdXBlcnRlc3QoQkFTRV9VUkwpXG4gICAgICAucHV0KGAvdXNlcnMvJHt1c2VyLmlkfWApXG4gICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VufWApXG4gICAgICAuc2VuZCh7XG4gICAgICAgIGVtYWlsLFxuICAgICAgICBhdmF0YXIsXG4gICAgICAgIHBhc3N3b3JkOiB1c2VyLnBhc3N3b3JkLFxuICAgICAgfSkuZXhwZWN0KDIwMClcblxuICAgIGFzc2VydC5leGlzdHMoYm9keS51c2VyLCAnVXNlciB1bmRlcmZpbmVkJylcbiAgICBhc3NlcnQuZXF1YWwoYm9keS51c2VyLmVtYWlsLCBlbWFpbClcbiAgICBhc3NlcnQuZXF1YWwoYm9keS51c2VyLmF2YXRhciwgYXZhdGFyKVxuICAgIGFzc2VydC5lcXVhbChib2R5LnVzZXIuaWQsIHVzZXIuaWQpXG4gIH0pXG5cbiAgdGVzdCgnaXQgc2hvdWxkIHVwZGF0ZSB0aGUgcGFzc3dvcmQgb2YgdGhlIHVzZXInLCBhc3luYyAoYXNzZXJ0KSA9PiB7XG4gICAgY29uc3QgcGFzc3dvcmQgPSAndGVzdCdcblxuICAgIGNvbnN0IHsgYm9keSB9ID0gYXdhaXQgc3VwZXJ0ZXN0KEJBU0VfVVJMKVxuICAgICAgLnB1dChgL3VzZXJzLyR7dXNlci5pZH1gKVxuICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHt0b2tlbn1gKVxuICAgICAgLnNlbmQoe1xuICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgYXZhdGFyOiB1c2VyLmF2YXRhcixcbiAgICAgICAgcGFzc3dvcmQsXG4gICAgICB9KS5leHBlY3QoMjAwKVxuXG4gICAgYXNzZXJ0LmV4aXN0cyhib2R5LnVzZXIsICdVc2VyIHVuZGVyZmluZWQnKVxuICAgIGFzc2VydC5lcXVhbChib2R5LnVzZXIuaWQsIHVzZXIuaWQpXG5cbiAgICBhd2FpdCB1c2VyLnJlZnJlc2goKVxuICAgIGFzc2VydC5pc1RydWUoYXdhaXQgSGFzaC52ZXJpZnkodXNlci5wYXNzd29yZCwgcGFzc3dvcmQpKVxuICB9KVxuXG4gIHRlc3QoJ2l0IHNob3VsZCByZXR1cm4gNDIyIHduaGUgcmVxdWlyZWQgZGF0YSBpcyBub3QgcHJvdmlkZWQnLCBhc3luYyAoYXNzZXJ0KSA9PiB7XG4gICAgY29uc3QgeyBpZCB9ID0gYXdhaXQgVXNlckZhY3RvcnkuY3JlYXRlKClcblxuICAgIGNvbnN0IHsgYm9keSB9ID0gYXdhaXQgc3VwZXJ0ZXN0KEJBU0VfVVJMKVxuICAgICAgLnB1dChgL3VzZXJzLyR7aWR9YClcbiAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7dG9rZW59YClcbiAgICAgIC5zZW5kKHt9KVxuICAgICAgLmV4cGVjdCg0MjIpXG5cbiAgICBhc3NlcnQuZXF1YWwoYm9keS5jb2RlLCAnQkFEX1JFUVVFU1QnKVxuICAgIGFzc2VydC5lcXVhbChib2R5LnN0YXR1cywgNDIyKVxuICB9KVxuXG4gIHRlc3QoJ2l0IHNob3VsZCByZXR1cm4gNDIyIHdoZW4gcHJvdmluZGluZyBhbiBpbnZhbGlkIGVtYWlsJywgYXN5bmMgKGFzc2VydCkgPT4ge1xuICAgIGNvbnN0IHsgaWQsIHBhc3N3b3JkLCBhdmF0YXIgfSA9IGF3YWl0IFVzZXJGYWN0b3J5LmNyZWF0ZSgpXG5cbiAgICBjb25zdCB7IGJvZHkgfSA9IGF3YWl0IHN1cGVydGVzdChCQVNFX1VSTClcbiAgICAgIC5wdXQoYC91c2Vycy8ke2lkfWApXG4gICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VufWApXG4gICAgICAuc2VuZCh7XG4gICAgICAgIHBhc3N3b3JkLFxuICAgICAgICBhdmF0YXIsXG4gICAgICAgIGVtYWlsOiAndGVzdEAnLFxuICAgICAgfSkuZXhwZWN0KDQyMilcblxuICAgIGFzc2VydC5lcXVhbChib2R5LmNvZGUsICdCQURfUkVRVUVTVCcpXG4gICAgYXNzZXJ0LmVxdWFsKGJvZHkuc3RhdHVzLCA0MjIpXG4gIH0pXG5cbiAgdGVzdCgnaXQgc2hvdWxkIHJldHVybiA0MjIgd2hlbiBwcm92aW5kaW5nIGFuIGludmFsaWQgcGFzc3dvcmQnLCBhc3luYyAoYXNzZXJ0KSA9PiB7XG4gICAgY29uc3QgeyBpZCwgZW1haWwsIGF2YXRhciB9ID0gYXdhaXQgVXNlckZhY3RvcnkuY3JlYXRlKClcblxuICAgIGNvbnN0IHsgYm9keSB9ID0gYXdhaXQgc3VwZXJ0ZXN0KEJBU0VfVVJMKVxuICAgICAgLnB1dChgL3VzZXJzLyR7aWR9YClcbiAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7dG9rZW59YClcbiAgICAgIC5zZW5kKHtcbiAgICAgICAgcGFzc3dvcmQ6ICd0ZXMnLFxuICAgICAgICBhdmF0YXIsXG4gICAgICAgIGVtYWlsLFxuICAgICAgfSkuZXhwZWN0KDQyMilcblxuICAgIGFzc2VydC5lcXVhbChib2R5LmNvZGUsICdCQURfUkVRVUVTVCcpXG4gICAgYXNzZXJ0LmVxdWFsKGJvZHkuc3RhdHVzLCA0MjIpXG4gIH0pXG5cbiAgdGVzdCgnaXQgc2hvdWxkIHJldHVybiA0MjIgd2hlbiBwcm92aW5kaW5nIGFuIGludmFsaWQgYXZhdGFyJywgYXN5bmMgKGFzc2VydCkgPT4ge1xuICAgIGNvbnN0IHsgaWQsIHBhc3N3b3JkLCBlbWFpbCB9ID0gYXdhaXQgVXNlckZhY3RvcnkuY3JlYXRlKClcblxuICAgIGNvbnN0IHsgYm9keSB9ID0gYXdhaXQgc3VwZXJ0ZXN0KEJBU0VfVVJMKVxuICAgICAgLnB1dChgL3VzZXJzLyR7aWR9YClcbiAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7dG9rZW59YClcbiAgICAgIC5zZW5kKHtcbiAgICAgICAgcGFzc3dvcmQsXG4gICAgICAgIGF2YXRhcjogJ3Rlc3RlJyxcbiAgICAgICAgZW1haWwsXG4gICAgICB9KS5leHBlY3QoNDIyKVxuXG4gICAgYXNzZXJ0LmVxdWFsKGJvZHkuY29kZSwgJ0JBRF9SRVFVRVNUJylcbiAgICBhc3NlcnQuZXF1YWwoYm9keS5zdGF0dXMsIDQyMilcbiAgfSlcblxuICBncm91cC5iZWZvcmUoYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHBsYWluUGFzc3dvcmQgPSAndGVzdCdcbiAgICBjb25zdCBuZXdVc2VyID0gYXdhaXQgVXNlckZhY3RvcnkubWVyZ2UoeyBwYXNzd29yZDogcGxhaW5QYXNzd29yZCB9KS5jcmVhdGUoKVxuICAgIGNvbnN0IHsgYm9keSB9ID0gYXdhaXQgc3VwZXJ0ZXN0KEJBU0VfVVJMKVxuICAgICAgLnBvc3QoJy9zZXNzaW9ucycpXG4gICAgICAuc2VuZCh7IGVtYWlsOiBuZXdVc2VyLmVtYWlsLCBwYXNzd29yZDogcGxhaW5QYXNzd29yZCB9KVxuICAgICAgLmV4cGVjdCgyMDEpXG5cbiAgICB0b2tlbiA9IGJvZHkudG9rZW4udG9rZW5cbiAgICB1c2VyID0gbmV3VXNlclxuICB9KVxuXG4gIGdyb3VwLmFmdGVyKGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBzdXBlcnRlc3QoQkFTRV9VUkwpXG4gICAgICAuZGVsZXRlKCcvc2Vzc2lvbnMnKVxuICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHt0b2tlbn1gKVxuICB9KVxuXG4gIGdyb3VwLmJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IERhdGFiYXNlLmJlZ2luR2xvYmFsVHJhbnNhY3Rpb24oKVxuICB9KVxuICBncm91cC5hZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IERhdGFiYXNlLnJvbGxiYWNrR2xvYmFsVHJhbnNhY3Rpb24oKVxuICB9KVxufSlcbiJdfQ==