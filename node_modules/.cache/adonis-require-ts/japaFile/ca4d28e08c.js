"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
require("reflect-metadata");
const path_1 = require("path");
const get_port_1 = __importDefault(require("get-port"));
const japa_1 = require("japa");
const source_map_support_1 = __importDefault(require("source-map-support"));
const execa_1 = __importDefault(require("execa"));
process.env.NODE_ENV = 'test';
process.env.ADONIS_ACE_CWD = (0, path_1.join)(__dirname);
source_map_support_1.default.install({ handleUncaughtExceptions: false });
async function runMigrations() {
    await execa_1.default.node('ace', ['migration:run'], {
        stdio: 'inherit',
    });
}
async function rollbackMigrations() {
    await execa_1.default.node('ace', ['migration:rollback'], {
        stdio: 'inherit',
    });
}
async function startHttpServer() {
    const { Ignitor } = await Promise.resolve().then(() => __importStar(require('@adonisjs/core/build/src/Ignitor')));
    process.env.PORT = String(await (0, get_port_1.default)());
    await new Ignitor(__dirname).httpServer().start();
}
(0, japa_1.configure)({
    files: ['test/**/*.spec.ts'],
    before: [runMigrations, startHttpServer],
    after: [rollbackMigrations],
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiamFwYUZpbGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJqYXBhRmlsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNEJBQXlCO0FBQ3pCLCtCQUEyQjtBQUMzQix3REFBOEI7QUFDOUIsK0JBQWdDO0FBQ2hDLDRFQUFpRDtBQUNqRCxrREFBeUI7QUFFekIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFBO0FBQzdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxHQUFHLElBQUEsV0FBSSxFQUFDLFNBQVMsQ0FBQyxDQUFBO0FBQzVDLDRCQUFnQixDQUFDLE9BQU8sQ0FBQyxFQUFFLHdCQUF3QixFQUFFLEtBQUssRUFBRSxDQUFDLENBQUE7QUFFN0QsS0FBSyxVQUFVLGFBQWE7SUFDMUIsTUFBTSxlQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFO1FBQ3pDLEtBQUssRUFBRSxTQUFTO0tBQ2pCLENBQUMsQ0FBQTtBQUNKLENBQUM7QUFFRCxLQUFLLFVBQVUsa0JBQWtCO0lBQy9CLE1BQU0sZUFBSyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFO1FBQzlDLEtBQUssRUFBRSxTQUFTO0tBQ2pCLENBQUMsQ0FBQTtBQUNKLENBQUM7QUFFRCxLQUFLLFVBQVUsZUFBZTtJQUM1QixNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsd0RBQWEsa0NBQWtDLEdBQUMsQ0FBQTtJQUNwRSxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxNQUFNLENBQUMsTUFBTSxJQUFBLGtCQUFPLEdBQUUsQ0FBQyxDQUFBO0lBQzFDLE1BQU0sSUFBSSxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUE7QUFDbkQsQ0FBQztBQUtELElBQUEsZ0JBQVMsRUFBQztJQUNSLEtBQUssRUFBRSxDQUFDLG1CQUFtQixDQUFDO0lBQzVCLE1BQU0sRUFBRSxDQUFDLGFBQWEsRUFBRSxlQUFlLENBQUM7SUFDeEMsS0FBSyxFQUFFLENBQUMsa0JBQWtCLENBQUM7Q0FDNUIsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdyZWZsZWN0LW1ldGFkYXRhJ1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3BhdGgnXG5pbXBvcnQgZ2V0UG9ydCBmcm9tICdnZXQtcG9ydCdcbmltcG9ydCB7IGNvbmZpZ3VyZSB9IGZyb20gJ2phcGEnXG5pbXBvcnQgc291cmNlTWFwU3VwcG9ydCBmcm9tICdzb3VyY2UtbWFwLXN1cHBvcnQnXG5pbXBvcnQgZXhlY2EgZnJvbSAnZXhlY2EnXG5cbnByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Rlc3QnXG5wcm9jZXNzLmVudi5BRE9OSVNfQUNFX0NXRCA9IGpvaW4oX19kaXJuYW1lKVxuc291cmNlTWFwU3VwcG9ydC5pbnN0YWxsKHsgaGFuZGxlVW5jYXVnaHRFeGNlcHRpb25zOiBmYWxzZSB9KVxuXG5hc3luYyBmdW5jdGlvbiBydW5NaWdyYXRpb25zKCkge1xuICBhd2FpdCBleGVjYS5ub2RlKCdhY2UnLCBbJ21pZ3JhdGlvbjpydW4nXSwge1xuICAgIHN0ZGlvOiAnaW5oZXJpdCcsXG4gIH0pXG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJvbGxiYWNrTWlncmF0aW9ucygpIHtcbiAgYXdhaXQgZXhlY2Eubm9kZSgnYWNlJywgWydtaWdyYXRpb246cm9sbGJhY2snXSwge1xuICAgIHN0ZGlvOiAnaW5oZXJpdCcsXG4gIH0pXG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0SHR0cFNlcnZlcigpIHtcbiAgY29uc3QgeyBJZ25pdG9yIH0gPSBhd2FpdCBpbXBvcnQoJ0BhZG9uaXNqcy9jb3JlL2J1aWxkL3NyYy9JZ25pdG9yJylcbiAgcHJvY2Vzcy5lbnYuUE9SVCA9IFN0cmluZyhhd2FpdCBnZXRQb3J0KCkpXG4gIGF3YWl0IG5ldyBJZ25pdG9yKF9fZGlybmFtZSkuaHR0cFNlcnZlcigpLnN0YXJ0KClcbn1cblxuLyoqXG4gKiBDb25maWd1cmUgdGVzdCBydW5uZXJcbiAqL1xuY29uZmlndXJlKHtcbiAgZmlsZXM6IFsndGVzdC8qKi8qLnNwZWMudHMnXSxcbiAgYmVmb3JlOiBbcnVuTWlncmF0aW9ucywgc3RhcnRIdHRwU2VydmVyXSxcbiAgYWZ0ZXI6IFtyb2xsYmFja01pZ3JhdGlvbnNdLFxufSlcbiJdfQ==