"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const BadRequestException_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Exceptions/BadRequestException"));
const Group_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/Group"));
const CreateGroupValidator_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Validators/CreateGroupValidator"));
class GroupsController {
    async index({ request, response }) {
        const { text, ['user']: userId } = request.qs();
        const page = request.input('page', 1);
        const limit = request.input('limit', 5);
        const groupsQuery = this.filterByQueryString(userId, text);
        const groups = await groupsQuery.paginate(page, limit);
        return response.ok({ groups });
    }
    async store({ request, response }) {
        const groupPayload = await request.validate(CreateGroupValidator_1.default);
        const group = await Group_1.default.create(groupPayload);
        await group.related('players').attach([groupPayload.master]);
        await group.load('players');
        return response.created({ group });
    }
    async update({ request, response, bouncer }) {
        const id = request.param('id');
        const payload = request.all();
        const group = await Group_1.default.findOrFail(id);
        await bouncer.authorize('updateGroup', group);
        const updatedGroup = await group.merge(payload).save();
        return response.ok({ group: updatedGroup });
    }
    async removePlayer({ request, response }) {
        const groupId = request.param('groupId');
        const playerId = +request.param('playerId');
        const group = await Group_1.default.findOrFail(groupId);
        if (playerId === group.master) {
            throw new BadRequestException_1.default('cannot remove master from group', 400);
        }
        await group.related('players').detach([playerId]);
        return response.ok({});
    }
    async destroy({ request, response, bouncer }) {
        const id = request.param('id');
        const group = await Group_1.default.findOrFail(id);
        await bouncer.authorize('deleteGroup', group);
        await group.delete();
        return response.ok({});
    }
    filterByQueryString(userId, text) {
        if (userId && text) {
            return this.filterByUserAndText(userId, text);
        }
        else if (userId) {
            return this.filterByUser(userId);
        }
        else if (text) {
            return this.filterByText(text);
        }
        else {
            return this.all();
        }
    }
    all() {
        return Group_1.default.query().preload('players').preload('masterUser');
    }
    filterByUser(userId) {
        return Group_1.default.query()
            .preload('players')
            .preload('masterUser')
            .withScopes((scope) => scope.withPlayer(userId));
    }
    filterByText(text) {
        return Group_1.default.query()
            .preload('players')
            .preload('masterUser')
            .withScopes((scope) => scope.withText(text));
    }
    filterByUserAndText(userId, text) {
        return Group_1.default.query()
            .preload('players')
            .preload('masterUser')
            .withScopes((scope) => scope.withPlayer(userId))
            .withScopes((scope) => scope.withText(text));
    }
}
exports.default = GroupsController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiR3JvdXBzQ29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkdyb3Vwc0NvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxtSEFBMkQ7QUFDM0QsbUZBQW9DO0FBQ3BDLHFIQUE2RDtBQUU3RCxNQUFxQixnQkFBZ0I7SUFFNUIsS0FBSyxDQUFDLEtBQUssQ0FBRSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQXVCO1FBRTVELE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRSxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsRUFBRSxFQUFFLENBQUE7UUFFL0MsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDckMsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFFdkMsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUMxRCxNQUFNLE1BQU0sR0FBRyxNQUFNLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBRXRELE9BQU8sUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFDLE1BQU0sRUFBQyxDQUFDLENBQUE7SUFLOUIsQ0FBQztJQUVNLEtBQUssQ0FBQyxLQUFLLENBQUUsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFzQjtRQUMzRCxNQUFNLFlBQVksR0FBRyxNQUFNLE9BQU8sQ0FBQyxRQUFRLENBQUMsOEJBQVcsQ0FBQyxDQUFBO1FBQ3hELE1BQU0sS0FBSyxHQUFHLE1BQU0sZUFBSyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQTtRQUU5QyxNQUFNLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsWUFBWSxDQUFDLE1B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Q0FBRSxNQUFjO1FBQ2xDLE9BQU8sZUFBSyxDQUFDLEtBQUssRUFBRTthQUNqQixPQUFPLENBQUMsU0FBUyxDQUFDO2FBQ2xCLE9BQU8sQ0FBQyxZQUFZLENBQUM7YUFDckIsVUFBVSxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUE7SUFDcEQsQ0FBQztJQUVPLFlBQVksQ0FBRSxJQUFZO1FBQ2hDLE9BQU8sZUFBSyxDQUFDLEtBQUssRUFBRTthQUNqQixPQUFPLENBQUMsU0FBUyxDQUFDO2FBQ2xCLE9BQU8sQ0FBQyxZQUFZLENBQUM7YUFDckIsVUFBVSxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7SUFDaEQsQ0FBQztJQUVPLG1CQUFtQixDQUFFLE1BQWMsRUFBRSxJQUFZO1FBQ3ZELE9BQU8sZUFBSyxDQUFDLEtBQUssRUFBRTthQUNqQixPQUFPLENBQUMsU0FBUyxDQUFDO2FBQ2xCLE9BQU8sQ0FBQyxZQUFZLENBQUM7YUFDckIsVUFBVSxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQy9DLFVBQVUsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBO0lBQ2hELENBQUM7Q0FDRjtBQTdHRCxtQ0E2R0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEh0dHBDb250ZXh0Q29udHJhY3QgfSBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0h0dHBDb250ZXh0J1xuaW1wb3J0IEJhZFJlcXVlc3QgZnJvbSAnQXBwL0V4Y2VwdGlvbnMvQmFkUmVxdWVzdEV4Y2VwdGlvbidcbmltcG9ydCBHcm91cCBmcm9tICdBcHAvTW9kZWxzL0dyb3VwJ1xuaW1wb3J0IENyZWF0ZUdyb3VwIGZyb20gJ0FwcC9WYWxpZGF0b3JzL0NyZWF0ZUdyb3VwVmFsaWRhdG9yJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHcm91cHNDb250cm9sbGVyIHtcbiAgLy8gSW5kZXggw6kgbyBub21lIHBhZHLDo28gZGUgbcOpdG9kbyBxdWUgbyBBZG9uaXMgdXRpbGl6YSBxdWFuZG8gw6kgcmV0b3JuYWRvIHVtYSBsaXN0YWdlbSBkZSBkYWRvcy5cbiAgcHVibGljIGFzeW5jIGluZGV4ICh7IHJlcXVlc3QsIHJlc3BvbnNlIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcbiAgICAvLyBQYXJhIHBlZ2FyIHBhcmFtZXRyb3MgcGFzc2Fkb3MgbmEgVVJsIMOpIHV0aWxpemFkbyBvIFwicXNcIlxuICAgIGNvbnN0IHsgdGV4dCwgWyd1c2VyJ106IHVzZXJJZCB9ID0gcmVxdWVzdC5xcygpXG5cbiAgICBjb25zdCBwYWdlID0gcmVxdWVzdC5pbnB1dCgncGFnZScsIDEpXG4gICAgY29uc3QgbGltaXQgPSByZXF1ZXN0LmlucHV0KCdsaW1pdCcsIDUpXG5cbiAgICBjb25zdCBncm91cHNRdWVyeSA9IHRoaXMuZmlsdGVyQnlRdWVyeVN0cmluZyh1c2VySWQsIHRleHQpXG4gICAgY29uc3QgZ3JvdXBzID0gYXdhaXQgZ3JvdXBzUXVlcnkucGFnaW5hdGUocGFnZSwgbGltaXQpXG5cbiAgICByZXR1cm4gcmVzcG9uc2Uub2soe2dyb3Vwc30pXG5cbiAgICAvLyBPIFwiYXMgYW55XCIgw6kgcGFyYSBjb3JyaWdpciB1bSBlcnJvIGRvIHR5cGVzY3JpcHRcbiAgICAvLyBxdWUgaXJpYSBhY3VzYXIgcXVlIFwiZ3JvdXBzXCIgbnVuY2Egc2VyaWEgbGlkbyBkZW50cm8gZG9zIElmcy9FbHNlXG4gICAgLy8gbGV0IGdyb3VwcyA9IFtdIGFzIGFueVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHN0b3JlICh7IHJlcXVlc3QsIHJlc3BvbnNlfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuICAgIGNvbnN0IGdyb3VwUGF5bG9hZCA9IGF3YWl0IHJlcXVlc3QudmFsaWRhdGUoQ3JlYXRlR3JvdXApXG4gICAgY29uc3QgZ3JvdXAgPSBhd2FpdCBHcm91cC5jcmVhdGUoZ3JvdXBQYXlsb2FkKVxuXG4gICAgYXdhaXQgZ3JvdXAucmVsYXRlZCgncGxheWVycycpLmF0dGFjaChbZ3JvdXBQYXlsb2FkLm1hc3Rlcl0pXG4gICAgYXdhaXQgZ3JvdXAubG9hZCgncGxheWVycycpXG5cbiAgICByZXR1cm4gcmVzcG9uc2UuY3JlYXRlZCh7IGdyb3VwIH0pXG4gIH1cblxuICBwdWJsaWMgYXN5bmMgdXBkYXRlICh7IHJlcXVlc3QsIHJlc3BvbnNlLCBib3VuY2VyIH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcbiAgICBjb25zdCBpZCA9IHJlcXVlc3QucGFyYW0oJ2lkJylcbiAgICBjb25zdCBwYXlsb2FkID0gcmVxdWVzdC5hbGwoKVxuICAgIGNvbnN0IGdyb3VwID0gYXdhaXQgR3JvdXAuZmluZE9yRmFpbChpZClcblxuICAgIGF3YWl0IGJvdW5jZXIuYXV0aG9yaXplKCd1cGRhdGVHcm91cCcsIGdyb3VwKVxuXG4gICAgY29uc3QgdXBkYXRlZEdyb3VwID0gYXdhaXQgZ3JvdXAubWVyZ2UocGF5bG9hZCkuc2F2ZSgpXG5cbiAgICByZXR1cm4gcmVzcG9uc2Uub2soeyBncm91cCA6IHVwZGF0ZWRHcm91cCB9KVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHJlbW92ZVBsYXllciAoeyByZXF1ZXN0LCByZXNwb25zZSB9OiBIdHRwQ29udGV4dENvbnRyYWN0KSB7XG4gICAgY29uc3QgZ3JvdXBJZCA9IHJlcXVlc3QucGFyYW0oJ2dyb3VwSWQnKSBhcyBudW1iZXJcblxuICAgIC8vIE8gc2ltYm9sbyBcIitcIiBuYSByZXF1ZXN0IMOpIHBhcmEgaW5kaWNhciBxdWUgc2Vyw6EgdW0gdGlwbyBudW1iZXIgZSBvIGNhY2hlIGRldmUgc2VyIGNhcnJlZ2FkbyBjb21vIG51bWJlci5cbiAgICBjb25zdCBwbGF5ZXJJZCA9ICtyZXF1ZXN0LnBhcmFtKCdwbGF5ZXJJZCcpXG5cbiAgICBjb25zdCBncm91cCA9IGF3YWl0IEdyb3VwLmZpbmRPckZhaWwoZ3JvdXBJZClcblxuICAgIGlmIChwbGF5ZXJJZCA9PT0gZ3JvdXAubWFzdGVyKSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdCgnY2Fubm90IHJlbW92ZSBtYXN0ZXIgZnJvbSBncm91cCcsIDQwMClcbiAgICB9XG4gICAgYXdhaXQgZ3JvdXAucmVsYXRlZCgncGxheWVycycpLmRldGFjaChbcGxheWVySWRdKVxuXG4gICAgcmV0dXJuIHJlc3BvbnNlLm9rKHt9KVxuICB9XG5cbiAgcHVibGljIGFzeW5jIGRlc3Ryb3kgKHsgcmVxdWVzdCwgcmVzcG9uc2UsIGJvdW5jZXIgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuICAgIGNvbnN0IGlkID0gcmVxdWVzdC5wYXJhbSgnaWQnKVxuICAgIGNvbnN0IGdyb3VwID0gYXdhaXQgR3JvdXAuZmluZE9yRmFpbChpZClcblxuICAgIGF3YWl0IGJvdW5jZXIuYXV0aG9yaXplKCdkZWxldGVHcm91cCcsIGdyb3VwKVxuXG4gICAgYXdhaXQgZ3JvdXAuZGVsZXRlKClcblxuICAgIC8vIEZvcm1hcyBkZSByZW1vdmVyIHVtIHJlbGFjaW9uYW1lbnRvXG4gICAgLy8gYXdhaXQgZ3JvdXAucmVsYXRlZCgncGxheWVycycpLmRldGFjaCgpXG4gICAgLy8gRXNzYSBuw6NvIMOpIGEgbWVsaG9yIGZvcm1hICBhIG1lbGhybyBmb3JtYSDDqSB1dGlsaXphbmRvICAnQ0FTQ0FERScgZGlyZXRvIG5hIG1pZ3JhdGlvblxuXG4gICAgcmV0dXJuIHJlc3BvbnNlLm9rKHt9KVxuICB9XG5cbiAgcHJpdmF0ZSBmaWx0ZXJCeVF1ZXJ5U3RyaW5nICh1c2VySWQ6IG51bWJlciwgdGV4dDogc3RyaW5nKSB7XG4gICAgaWYgKHVzZXJJZCAmJiB0ZXh0KSB7XG4gICAgICByZXR1cm4gdGhpcy5maWx0ZXJCeVVzZXJBbmRUZXh0KHVzZXJJZCwgdGV4dClcbiAgICB9IGVsc2UgaWYgKHVzZXJJZCkge1xuICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyQnlVc2VyKHVzZXJJZClcbiAgICB9IGVsc2UgaWYgKHRleHQpIHtcbiAgICAgIHJldHVybiB0aGlzLmZpbHRlckJ5VGV4dCh0ZXh0KVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5hbGwoKVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWxsICgpIHtcbiAgICByZXR1cm4gR3JvdXAucXVlcnkoKS5wcmVsb2FkKCdwbGF5ZXJzJykucHJlbG9hZCgnbWFzdGVyVXNlcicpXG4gIH1cblxuICBwcml2YXRlIGZpbHRlckJ5VXNlciAodXNlcklkOiBudW1iZXIpIHtcbiAgICByZXR1cm4gR3JvdXAucXVlcnkoKVxuICAgICAgLnByZWxvYWQoJ3BsYXllcnMnKVxuICAgICAgLnByZWxvYWQoJ21hc3RlclVzZXInKVxuICAgICAgLndpdGhTY29wZXMoKHNjb3BlKSA9PiBzY29wZS53aXRoUGxheWVyKHVzZXJJZCkpXG4gIH1cblxuICBwcml2YXRlIGZpbHRlckJ5VGV4dCAodGV4dDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIEdyb3VwLnF1ZXJ5KClcbiAgICAgIC5wcmVsb2FkKCdwbGF5ZXJzJylcbiAgICAgIC5wcmVsb2FkKCdtYXN0ZXJVc2VyJylcbiAgICAgIC53aXRoU2NvcGVzKChzY29wZSkgPT4gc2NvcGUud2l0aFRleHQodGV4dCkpXG4gIH1cblxuICBwcml2YXRlIGZpbHRlckJ5VXNlckFuZFRleHQgKHVzZXJJZDogbnVtYmVyLCB0ZXh0OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gR3JvdXAucXVlcnkoKVxuICAgICAgLnByZWxvYWQoJ3BsYXllcnMnKVxuICAgICAgLnByZWxvYWQoJ21hc3RlclVzZXInKVxuICAgICAgLndpdGhTY29wZXMoKHNjb3BlKSA9PiBzY29wZS53aXRoUGxheWVyKHVzZXJJZCkpXG4gICAgICAud2l0aFNjb3Blcygoc2NvcGUpID0+IHNjb3BlLndpdGhUZXh0KHRleHQpKVxuICB9XG59XG4iXX0=