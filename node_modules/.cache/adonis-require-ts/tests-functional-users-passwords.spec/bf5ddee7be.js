"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("./../../database/factories/index");
const runner_1 = require("@japa/runner");
const Mail_1 = __importDefault(global[Symbol.for('ioc.use')]("Adonis/Addons/Mail"));
const BASE_URL = `http://${process.env.HOST}:${process.env.PORT}`;
runner_1.test.group('Password', (group) => {
    (0, runner_1.test)('it should send and email with forgot password instructions', async ({ assert, client }) => {
        const user = await index_1.UserFactory.create();
        const mailer = Mail_1.default.fake();
        await client
            .post('/forgot-password')
            .json({
            email: user.email,
            resetPasswordUrl: 'url',
        });
        assert.isTrue(mailer.exists({ to: [{ address: user.email }] }));
        assert.isTrue(mailer.exists({ from: { address: 'no-reply@roleplay.com' } }));
        assert.isTrue(mailer.exists({ subject: 'Roleplay: Recuperação de Senha' }));
        assert.isTrue(mailer.exists((mail) => mail.html.includes(user.username)));
        Mail_1.default.restore();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFzc3dvcmRzLnNwZWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJwYXNzd29yZHMuc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLDREQUE4RDtBQUc5RCx5Q0FBbUM7QUFDbkMsb0ZBQTBDO0FBRTFDLE1BQU0sUUFBUSxHQUFHLFVBQVUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtBQUVqRSxhQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO0lBQy9CLElBQUEsYUFBSSxFQUFDLDREQUE0RCxFQUFFLEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFO1FBQzlGLE1BQU0sSUFBSSxHQUFHLE1BQU0sbUJBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtRQUV2QyxNQUFNLE1BQU0sR0FBRyxjQUFJLENBQUMsSUFBSSxFQUFFLENBQUE7UUFFMUIsTUFBTSxNQUFNO2FBQ1QsSUFBSSxDQUFDLGtCQUFrQixDQUFDO2FBQ3hCLElBQUksQ0FBQztZQUNKLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztZQUNqQixnQkFBZ0IsRUFBRSxLQUFLO1NBQ3hCLENBQUMsQ0FBQTtRQUVKLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQy9ELE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQzVFLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUMzRSxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFFMUUsY0FBSSxDQUFDLE9BQU8sRUFBRSxDQUFBO0lBQ2hCLENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSGFzaCBmcm9tICdAaW9jOkFkb25pcy9Db3JlL0hhc2gnXG5pbXBvcnQgeyBVc2VyRmFjdG9yeSB9IGZyb20gJy4vLi4vLi4vZGF0YWJhc2UvZmFjdG9yaWVzL2luZGV4J1xuaW1wb3J0IERhdGFiYXNlIGZyb20gJ0Bpb2M6QWRvbmlzL0x1Y2lkL0RhdGFiYXNlJ1xuaW1wb3J0IHsgRGF0ZVRpbWUsIER1cmF0aW9uIH0gZnJvbSAnbHV4b24nXG5pbXBvcnQgeyB0ZXN0IH0gZnJvbSAnQGphcGEvcnVubmVyJ1xuaW1wb3J0IE1haWwgZnJvbSAnQGlvYzpBZG9uaXMvQWRkb25zL01haWwnXG5cbmNvbnN0IEJBU0VfVVJMID0gYGh0dHA6Ly8ke3Byb2Nlc3MuZW52LkhPU1R9OiR7cHJvY2Vzcy5lbnYuUE9SVH1gXG5cbnRlc3QuZ3JvdXAoJ1Bhc3N3b3JkJywgKGdyb3VwKSA9PiB7XG4gIHRlc3QoJ2l0IHNob3VsZCBzZW5kIGFuZCBlbWFpbCB3aXRoIGZvcmdvdCBwYXNzd29yZCBpbnN0cnVjdGlvbnMnLCBhc3luYyAoeyBhc3NlcnQsIGNsaWVudCB9KSA9PiB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXJGYWN0b3J5LmNyZWF0ZSgpXG5cbiAgICBjb25zdCBtYWlsZXIgPSBNYWlsLmZha2UoKVxuXG4gICAgYXdhaXQgY2xpZW50XG4gICAgICAucG9zdCgnL2ZvcmdvdC1wYXNzd29yZCcpXG4gICAgICAuanNvbih7XG4gICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICByZXNldFBhc3N3b3JkVXJsOiAndXJsJyxcbiAgICAgIH0pXG5cbiAgICBhc3NlcnQuaXNUcnVlKG1haWxlci5leGlzdHMoeyB0bzogW3sgYWRkcmVzczogdXNlci5lbWFpbCB9XSB9KSlcbiAgICBhc3NlcnQuaXNUcnVlKG1haWxlci5leGlzdHMoeyBmcm9tOiB7IGFkZHJlc3M6ICduby1yZXBseUByb2xlcGxheS5jb20nIH0gfSkpXG4gICAgYXNzZXJ0LmlzVHJ1ZShtYWlsZXIuZXhpc3RzKHsgc3ViamVjdDogJ1JvbGVwbGF5OiBSZWN1cGVyYcOnw6NvIGRlIFNlbmhhJyB9KSlcbiAgICBhc3NlcnQuaXNUcnVlKG1haWxlci5leGlzdHMoKG1haWwpID0+IG1haWwuaHRtbCEuaW5jbHVkZXModXNlci51c2VybmFtZSkpKVxuXG4gICAgTWFpbC5yZXN0b3JlKClcbiAgfSlcbn0pXG4iXX0=